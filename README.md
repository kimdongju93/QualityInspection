# 작업자 감지 및 알람 시스템

CCTV 또는 비디오 파일을 이용하여 공장 내 특정 구역(위험구역, ROI)에 작업자가 진입할 경우 알람을 발생시키고, 스냅샷을 저장하는 시스템입니다.

## 주요 기능

- 실시간 CCTV(또는 비디오 파일) 영상 분석
- YOLOv8을 이용한 작업자 감지
- 사용자 정의 관심 영역(ROI, 위험구역) 설정 및 표시
- 작업자 진입 시 시각/청각 알람
- ROI(위험구역) 진입 작업자 스냅샷 자동 저장 (동일 작업자 3초 간격)
- 저장된 스냅샷에도 ROI(위험구역) 표시
- 스냅샷 패널 및 썸네일 제공

## 설치 방법

1. 필요한 패키지 설치:
```bash
pip install -r requirements.txt
```

2. YOLOv8 모델 다운로드:
```bash
# 자동으로 다운로드됩니다 (첫 실행 시)
```

3. 알람 소리 파일 준비:
- `alarm.wav` 파일을 프로젝트 디렉토리에 복사

## 사용 방법

### 1. 실시간 카메라/웹캠 감지 (알람 포함)
```bash
python worker_detection.py
```
- 'r' 키: ROI(위험구역) 설정 모드 진입 (마우스로 4점 클릭)
- 'q' 키: 프로그램 종료

### 2. 비디오 파일 분석 및 스냅샷/패널
```bash
python video_analysis.py
```
- 비디오 파일 내 작업자 감지 및 ROI 진입 시 스냅샷 자동 저장
- 스냅샷에는 ROI(위험구역) 표시
- 'r' 키: ROI(위험구역) 재설정
- 'q' 키: 프로그램 종료

### 3. 스냅샷 확인 및 패널 테스트
- 최신 10개 스냅샷 목록 확인:
```bash
python test_snapshots.py
```
- 스냅샷 썸네일 패널 시각화:
```bash
python test_panel.py
```

## 환경 설정

`.env` 파일을 생성하여 카메라 URL을 설정할 수 있습니다:
```
CAMERA_URL=0  # 0은 기본 웹캠, IP 카메라의 경우 URL 입력
```

## 주요 변경점 및 주의사항
- **동일 작업자(객체)에 대해 3초 간격으로만 스냅샷이 저장됩니다.**
- **저장되는 모든 스냅샷 이미지에는 ROI(위험구역)가 파란색 선과 '위험구역' 텍스트로 표시됩니다.**
- 충분한 조명이 확보된 환경에서 사용하세요.
- 카메라가 안정적으로 고정되어 있어야 합니다.
- 알람 소리 파일이 올바른 형식이어야 합니다.

## 의존성
- opencv-python
- numpy
- ultralytics
- playsound
- python-dotenv

자세한 버전은 requirements.txt를 참고하세요. 